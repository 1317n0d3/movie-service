(()=>{"use strict";const e=document.querySelector(".wrap"),t=new class{constructor(t){this.filmList=new class{constructor(){this.filmList=[],this.loadFilmList()}addFilm(e){this.filmList.push(this.createFilm(e))}createFilm(t){let{id:i,title:r,country:n,genre:s,director:o,filmScript:l,producer:a,operator:c,composer:u,budget:d,worldFees:h,ageRating:m,duration:p,releaseDate:f,poster:v}=t;return new class{constructor(e,t,i,r,n,s,o,l,a,c,u,d,h,m,p){this.id=e,this.title=t,this.country=i,this.genre=r,this.director=n,this.filmScript=s,this.producer=o,this.operator=l,this.composer=a,this.budget=c,this.worldFees=u,this.ageRating=d,this.duration=h,this.releaseDate=m,this.poster=p}render(){e.innerHTML+=`\n      <div class="wrap__item" data-index="${this.id}">\n        <div class="wrap__item__context" id="contextMenu">\n          <button id="btnViewFilm" data-action="view" data-index="${this.id}">\n            <img src="../../assets/icons/view.svg" alt="icon: view film">\n          </button>\n          <button id="btnDeleteFilm" data-action="delete" data-index="${this.id}">\n            <img src="../../assets/icons/trash.svg" alt="icon: delete film">\n          </button>\n        </div>\n        <div class="wrap__item__content">\n          <img src="${this.poster}" alt="image: ${this.title}">\n          <span>${this.title}</span>\n        </div>\n      </div>\n    `}renderFilmInfo(e){const t=new Date(this.releaseDate);e.innerHTML=`\n      <div class="film-info__main">\n        <div class="film-info__main__description">\n          <img src="${this.poster}" alt="image: ${this.title}">\n          <p>Название: ${this.title}</p>\n          <p>Страна: ${this.country.join(", ")}</p>\n          <p>Жанр: ${this.genre.join(", ")}</p>\n          <p>Режиссер: ${this.director}</p>\n          <p>Продюсер: ${this.producer}</p>\n          <p>Оператор: ${this.operator}</p>\n          <p>Композитор: ${this.composer}</p>\n          <p>Бюджет: ${this.budget}</p>\n          <p>Мировые сборы: ${this.worldFees}</p>\n          <p>Возрастной рейтинг: ${this.ageRating}</p>\n          <p>Длительность: ${this.duration}</p>\n          <p>Премьера: ${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}</p>\n        </div>\n        <div class="film-info__main__title">\n          <h2>${this.title}</h2>\n          <p>${this.filmScript}</p>\n        </div>\n      </div>\n      <div class="film-info__comments">\n        <h2>Комментарии</h2>\n      </div>\n    `}}(i,r,n,s,o,l,a,c,u,d,h,m,p,f,v)}deleteFilm(e){this.filmList=this.filmList.filter((t=>t.id!==e))}loadFilmList(){const e=JSON.parse(localStorage.getItem("films"));e&&e.forEach((e=>{this.filmList.push(this.createFilm(e))}))}saveFilmList(){localStorage.setItem("films",JSON.stringify(this.filmList))}generateItemId(){return this.filmList.length>0?this.filmList[this.filmList.length-1].id+1:this.filmList.length}getFilmList(){return this.filmList}renderFilmInfo(e,t){this.filmList.filter((t=>t.id===e))[0].renderFilmInfo(t)}render(){this.saveFilmList(),e.innerHTML="",this.filmList.forEach((e=>{e.render()}))}renderWithoutSaving(){e.innerHTML="",this.filmList.forEach((e=>{e.render()}))}},this.filter=new class{constructor(){this.countries=[],this.genres=[]}updateCountries(e){this.countries=[],e.forEach((e=>{e.country.forEach((e=>{-1===this.countries.indexOf(e)&&this.countries.push(e)}))}));const t=document.querySelector("#filterCountry");t.innerHTML='<option value="default">Страна</option>',this.countries.forEach((e=>{t.innerHTML+=`<option value="${e}">${e}</option>`}))}updateGenres(e){this.genres=[],e.forEach((e=>{e.genre.forEach((e=>{-1===this.genres.indexOf(e)&&this.genres.push(e)}))}));const t=document.querySelector("#filterGenre");t.innerHTML='<option value="default">Жанр</option>',this.genres.forEach((e=>{t.innerHTML+=`<option value="${e}">${e}</option>`}))}updateFilterData(e){this.updateCountries(e.getFilmList()),this.updateGenres(e.getFilmList())}sortByCountry(t,i){if("default"===i)return t.renderWithoutSaving();const r=t.getFilmList().filter((e=>-1!==e.country.indexOf(i)));e.innerHTML="",r.forEach((e=>{e.render()}))}sortByGenre(t,i){if("default"===i)return t.renderWithoutSaving();const r=t.getFilmList().filter((e=>-1!==e.genre.indexOf(i)));e.innerHTML="",r.forEach((e=>{e.render()}))}sortByNewest(t,i){let r=[];if("default"===i)return t.renderWithoutSaving();"newest"===i?r=t.getFilmList().sort(((e,t)=>t.releaseDate-e.releaseDate)):"oldest"===i&&(r=t.getFilmList().sort(((e,t)=>e.releaseDate-t.releaseDate))),e.innerHTML="",r.forEach((e=>{e.render()}))}},this.wrap=t,t.onclick=this.onClick.bind(this)}view(e){const t=document.querySelector(".film-info");this.filmList.renderFilmInfo(+e,t),t.style.display="block"}delete(e){this.filmList.deleteFilm(+e),this.render()}onClick(){let e=event.target.parentNode.dataset.action;const t=event.target.parentNode.dataset.index;e&&this[e](t)}addFilm(){this.filmList.addFilm(this.getNewFilmData()),this.render()}getNewFilmData(){const e=document.querySelector("#title"),t=document.querySelector("#director"),i=document.querySelector("#filmScript"),r=document.querySelector("#country"),n=document.querySelector("#genre"),s=document.querySelector("#producer"),o=document.querySelector("#operator"),l=document.querySelector("#composer"),a=document.querySelector("#budget"),c=document.querySelector("#worldFees"),u=document.querySelector("#ageRating"),d=document.querySelector("#duration"),h=document.querySelector("#releaseDate"),m=document.querySelector("#poster"),p={id:this.filmList.generateItemId(),title:e.value,country:[],genre:[],director:t.value,filmScript:i.value,producer:s.value,operator:o.value,composer:l.value,budget:a.value,worldFees:c.value,ageRating:u.value,duration:d.value,releaseDate:h.valueAsNumber,poster:""===m.value?"https://mimicosmetic.ru/wp-content/uploads/woocommerce-placeholder.png":document.querySelector("#poster").value};return r.value.split(",").forEach((e=>{p.country.push(e.trim().toLowerCase())})),n.value.split(",").forEach((e=>{p.genre.push(e.trim().toLowerCase())})),e.value="",t.value="",i.value="",r.value="",n.value="",s.value="",o.value="",l.value="",a.value="",c.value="",u.value="",d.value="",h.value="",m.value="",r.value="",n.value="",p}render(){this.filter.updateFilterData(this.filmList),this.filmList.render()}initEventListeners(){const e=document.querySelector("#btnShowForm"),t=document.querySelector("#btnShowFilms"),i=document.querySelector(".film-info"),r=document.querySelector(".add-film-form"),n=document.querySelector("#btnAddFilm");t.addEventListener("click",(()=>{i.style.display="none"})),e.addEventListener("click",(()=>{r.classList.toggle("invisible")})),n.addEventListener("click",(()=>{this.addFilm(),this.render()}));const s=document.querySelector("#filterCountry"),o=document.querySelector("#filterGenre"),l=document.querySelector("#filterDate");s.addEventListener("change",(e=>{this.filter.sortByCountry(this.filmList,e.target.value)})),o.addEventListener("change",(e=>{this.filter.sortByGenre(this.filmList,e.target.value)})),l.addEventListener("change",(e=>{this.filter.sortByNewest(this.filmList,e.target.value)}))}}(document.querySelector(".wrap"));t.initEventListeners(),t.render()})();
(()=>{"use strict";const e=document.querySelector(".wrap"),t=new class{constructor(t){this.filmList=new class{constructor(){this.filmList=[],this.loadFilmList()}addFilm(e){this.filmList.push(this.createFilm(e))}createFilm(t){let{id:i,title:r,country:s,genre:n,director:o,filmScript:l,producer:a,operator:c,composer:u,budget:d,worldFees:m,ageRating:h,duration:g,releaseDate:p,poster:f}=t;return new class{constructor(e,t,i,r,s,n,o,l,a,c,u,d,m,h,g){this.id=e,this.title=t,this.country=i,this.genre=r,this.director=s,this.filmScript=n,this.producer=o,this.operator=l,this.composer=a,this.budget=c,this.worldFees=u,this.ageRating=d,this.duration=m,this.releaseDate=h,this.poster=g}render(){e.innerHTML+=`\n      <div class="wrap__item" data-index="${this.id}">\n        <div class="wrap__item__context" id="contextMenu">\n          <button id="btnViewFilm" data-action="view" data-index="${this.id}">\n            <img src="../../assets/icons/view.svg" alt="icon: view film">\n          </button>\n          <button id="btnDeleteFilm" data-action="delete" data-index="${this.id}">\n            <img src="../../assets/icons/trash.svg" alt="icon: delete film">\n          </button>\n        </div>\n        <div class="wrap__item__content">\n          <img src="${this.poster}" alt="image: ${this.title}">\n          <span>${this.title}</span>\n        </div>\n      </div>\n    `}renderFilmInfo(e){const t=new Date(this.releaseDate);e.innerHTML=`\n      <div class="film-info__main">\n        <div class="film-info__main__description">\n          <img src="${this.poster}" alt="image: ${this.title}">\n          <p>Название: ${this.title}</p>\n          <p>Страна: ${this.country.join(", ")}</p>\n          <p>Жанр: ${this.genre.join(", ")}</p>\n          <p>Режиссер: ${this.director}</p>\n          <p>Продюсер: ${this.producer}</p>\n          <p>Оператор: ${this.operator}</p>\n          <p>Композитор: ${this.composer}</p>\n          <p>Бюджет: ${this.budget}</p>\n          <p>Мировые сборы: ${this.worldFees}</p>\n          <p>Возрастной рейтинг: ${this.ageRating}</p>\n          <p>Длительность: ${this.duration}</p>\n          <p>Премьера: ${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}</p>\n        </div>\n        <div class="film-info__main__title">\n          <h2>${this.title}</h2>\n          <p>${this.filmScript}</p>\n        </div>\n      </div>\n      <div class="film-info__comments">\n        <h2>Комментарии</h2>\n      </div>\n    `}}(i,r,s,n,o,l,a,c,u,d,m,h,g,p,f)}deleteFilm(e){this.filmList=this.filmList.filter((t=>t.id!==e))}loadFilmList(){const e=JSON.parse(localStorage.getItem("films"));e&&e.forEach((e=>{this.filmList.push(this.createFilm(e))}))}saveFilmList(){localStorage.setItem("films",JSON.stringify(this.filmList))}generateItemId(){return this.filmList.length>0?this.filmList[this.filmList.length-1].id+1:this.filmList.length}getFilmList(){return this.filmList}renderFilmInfo(e,t){this.filmList.filter((t=>t.id===e))[0].renderFilmInfo(t)}render(){this.saveFilmList(),e.innerHTML="",this.filmList.forEach((e=>{e.render()}))}renderWithoutSaving(){e.innerHTML="",this.filmList.forEach((e=>{e.render()}))}},this.filter=new class{constructor(){this.countries=[],this.genres=[]}updateCountries(e){this.countries=[],e.forEach((e=>{e.country.forEach((e=>{-1===this.countries.indexOf(e)&&this.countries.push(e)}))}));const t=document.querySelector("#filterCountry");t.innerHTML='<option value="default">Страна</option>',this.countries.forEach((e=>{t.innerHTML+=`<option value="${e}">${e}</option>`}))}updateGenres(e){this.genres=[],e.forEach((e=>{e.genre.forEach((e=>{-1===this.genres.indexOf(e)&&this.genres.push(e)}))}));const t=document.querySelector("#filterGenre");t.innerHTML='<option value="default">Жанр</option>',this.genres.forEach((e=>{t.innerHTML+=`<option value="${e}">${e}</option>`}))}updateFilterData(e){this.updateCountries(e.getFilmList()),this.updateGenres(e.getFilmList())}sortByCountry(t,i){if("default"===i)return t.renderWithoutSaving();const r=t.getFilmList().filter((e=>-1!==e.country.indexOf(i)));e.innerHTML="",r.forEach((e=>{e.render()}))}sortByGenre(t,i){if("default"===i)return t.renderWithoutSaving();const r=t.getFilmList().filter((e=>-1!==e.genre.indexOf(i)));e.innerHTML="",r.forEach((e=>{e.render()}))}sortByNewest(t,i){let r=[];if("default"===i)return t.renderWithoutSaving();"newest"===i?r=t.getFilmList().sort(((e,t)=>t.releaseDate-e.releaseDate)):"oldest"===i&&(r=t.getFilmList().sort(((e,t)=>e.releaseDate-t.releaseDate))),e.innerHTML="",r.forEach((e=>{e.render()}))}},this.user=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):{},this.wrap=t,t.onclick=this.onClick.bind(this)}view(e){const t=document.querySelector(".film-info");this.filmList.renderFilmInfo(+e,t),t.style.display="block"}delete(e){this.filmList.deleteFilm(+e),this.render()}onClick(){let e=event.target.parentNode.dataset.action;const t=event.target.parentNode.dataset.index;e&&this[e](t)}addFilm(){this.filmList.addFilm(this.getNewFilmData()),this.render()}getNewFilmData(){const e=document.querySelector("#title"),t=document.querySelector("#director"),i=document.querySelector("#filmScript"),r=document.querySelector("#country"),s=document.querySelector("#genre"),n=document.querySelector("#producer"),o=document.querySelector("#operator"),l=document.querySelector("#composer"),a=document.querySelector("#budget"),c=document.querySelector("#worldFees"),u=document.querySelector("#ageRating"),d=document.querySelector("#duration"),m=document.querySelector("#releaseDate"),h=document.querySelector("#poster"),g={id:this.filmList.generateItemId(),title:e.value,country:[],genre:[],director:t.value,filmScript:i.value,producer:n.value,operator:o.value,composer:l.value,budget:a.value,worldFees:c.value,ageRating:u.value,duration:d.value,releaseDate:m.valueAsNumber,poster:""===h.value?"https://mimicosmetic.ru/wp-content/uploads/woocommerce-placeholder.png":document.querySelector("#poster").value};return r.value.split(",").forEach((e=>{g.country.push(e.trim().toLowerCase())})),s.value.split(",").forEach((e=>{g.genre.push(e.trim().toLowerCase())})),e.value="",t.value="",i.value="",r.value="",s.value="",n.value="",o.value="",l.value="",a.value="",c.value="",u.value="",d.value="",m.value="",h.value="",r.value="",s.value="",g}render(){this.initUserInfo(),this.filter.updateFilterData(this.filmList),this.filmList.render()}initUserInfo(){localStorage.getItem("user")&&(userLogin.textContent=this.user.inputLogin,userLogin.classList.remove("invisible"),imgLogOut.classList.remove("invisible"),registrationForm.classList.add("invisible"),logIn.classList.add("invisible"))}registration(){const e={inputLogin:document.querySelector("#inputLogin").value,inputProfession:document.querySelector("#inputProfession").value};localStorage.setItem("user",JSON.stringify(e)),this.user=JSON.parse(localStorage.getItem("user"))}initEventListeners(){const e=document.querySelector("#logIn"),t=document.querySelector("#registrationForm"),i=document.querySelector("#btnRegistration"),r=document.querySelector("#imgLogOut"),s=document.querySelector("#userLogin");e.addEventListener("click",(()=>{t.classList.toggle("invisible")})),t.addEventListener("mouseleave",(()=>{t.classList.add("invisible")})),i.addEventListener("click",(()=>{this.registration(),this.initUserInfo()})),r.addEventListener("click",(()=>{localStorage.removeItem("user"),s.classList.add("invisible"),r.classList.add("invisible"),e.classList.remove("invisible")}));const n=document.querySelector("#btnShowForm"),o=document.querySelector("#btnShowFilms"),l=document.querySelector(".film-info"),a=document.querySelector(".add-film-form"),c=document.querySelector("#btnAddFilm");o.addEventListener("click",(()=>{l.style.display="none"})),n.addEventListener("click",(()=>{a.classList.toggle("invisible")})),c.addEventListener("click",(()=>{this.addFilm(),this.render()}));const u=document.querySelector("#filterCountry"),d=document.querySelector("#filterGenre"),m=document.querySelector("#filterDate");u.addEventListener("change",(e=>{this.filter.sortByCountry(this.filmList,e.target.value)})),d.addEventListener("change",(e=>{this.filter.sortByGenre(this.filmList,e.target.value)})),m.addEventListener("change",(e=>{this.filter.sortByNewest(this.filmList,e.target.value)}))}}(document.querySelector(".wrap"));t.initEventListeners(),t.render()})();